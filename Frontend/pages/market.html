<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PVA Bazaar — Global Independent Marketplace</title>
  <meta name="description" content="Buy and sell anything with verified provenance: coffee beans, jewelry, produce, vehicles, energy products, art, services, and more. Optional NFT minting available." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Z6b9iQX9a0mQ5Hh9jI1mZtT7S1sU7VwzH9Zk1mJvH8U+f3jYw9e8N5m5q7y8wVb8S6s9M+v8X5o+QJYw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- PWA Configuration -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#143d2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="PVA Bazaar">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  
  <style>
    :root {
      --primary-dark: #0a2c21; 
      --primary: #143d2e; 
      --primary-light: #1e4e3c; 
      --accent: #3ac389; 
      --accent-dark: #2a9c6f; 
      --text-light: #e8f4f0; 
      --text-muted: #a8b0b9; 
      --card: #0f1f1a; 
      --border: rgba(255,255,255,.08);
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
    }
    
    html, body {
      background: linear-gradient(180deg, #071811, #0c221a 35%, #10271f 100%); 
      color: var(--text-light); 
      font-family: Poppins, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      min-height: 100vh;
      scroll-behavior: smooth;
    }
    
    .glass {
      background: rgba(255,255,255,.04); 
      border: 1px solid var(--border); 
      backdrop-filter: blur(6px);
    }
    
    .chip {
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .chip.active, .chip:hover {
      background: var(--accent-dark); 
      border-color: transparent;
      transform: translateY(-2px);
    }
    
    .brand {
      font-family: "Playfair Display", serif;
    }
    
    /* Loading animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    /* Cart badge */
    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--accent);
      color: black;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    /* Skeleton loading */
    .skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 0.5rem;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--primary-dark);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-light);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-dark);
    }
    
    /* Floating action button for mobile */
    .fab {
      position: fixed;
      bottom: 2rem;
      right: 1rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--accent);
      color: black;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      z-index: 30;
      font-size: 1.5rem;
    }
    
    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      z-index: 50;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <!-- Header / Navigation -->
      <header>
      <a href="/" class="logo">
        <i class="fas fa-gem logo-icon"></i>
        <div class="logo-text">PVA Bazaar</div>
      </a>
      <nav>
        <ul>
          <li><a href="/" class="active">Home</a></li>
          <li><a href="/pages/pvadashboard.html">Dashboard</a></li>
          <li><a href="/pages/productshowcase.html">Marketplace</a></li>
          <li><a href="/pages/portfolio.html">Portfolio</a></li>
          <li><a href="/pages/checkoutmint.html">Checkout</a></li>
          <li><a href="/pages/provenance.html">Provenance</a></li>
          <li><a href="/pages/artifact.html">Artifact</a></li>
        </ul>
      </nav>
      <div class="header-actions">
        <button class="icon-btn" id="searchToggle" title="Search">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
        <button class="btn" id="connectWallet">
          <i class="fa-solid fa-wallet"></i>
          Connect Wallet
        </button>
      </div>
    </header>

  <!-- Hero Section -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-6">
    <div class="grid md:grid-cols-2 gap-8 items-center">
      <div class="animate-fade-in">
        <h1 class="brand text-3xl sm:text-4xl md:text-5xl leading-tight">The Global Independent Marketplace</h1>
        <p class="mt-3 text-white/80 max-w-prose">Coffee beans, jewelry, tomatoes, cars, oil, art, services — if a human can create it or needs it, it belongs here. Trade freely with transparent provenance and optional on-chain minting.</p>
        
        <div class="mt-6 p-4 glass rounded-xl">
          <div class="flex items-center gap-3">
            <div class="flex-1">
              <div class="text-sm font-medium">Marketplace Status</div>
              <div class="text-xs text-[color:var(--accent)] flex items-center gap-1 mt-1">
                <div class="w-2 h-2 rounded-full bg-[color:var(--accent)] animate-pulse"></div>
                <span>Live & Operational</span>
              </div>
            </div>
            <div class="text-right">
              <div class="text-sm font-medium" id="activeListings">...</div>
              <div class="text-xs text-white/60">Active Listings</div>
            </div>
          </div>
        </div>
        
        <div class="mt-5 flex flex-wrap gap-3">
          <a href="#listings" class="px-4 py-2 rounded-xl bg-[color:var(--accent)] text-black font-semibold hover:shadow-lg hover:shadow-[color:var(--accent-dark)]/25 transition-shadow">Browse all</a>
          <a href="/pvadashboard.html" class="px-4 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors">List an item</a>
          <a href="/provenance.html" class="px-4 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors flex items-center gap-2">
            <i class="fa-solid fa-shield-check"></i> Provenance
          </a>
        </div>
        
        <div class="mt-4 text-xs text-white/60">By using PVA Bazaar you agree to community rules and independent trade principles.</div>
      </div>
      
      <div class="glass rounded-2xl p-4 animate-fade-in" style="animation-delay: 0.2s;">
        <div class="grid grid-cols-3 gap-3">
          <img class="rounded-xl aspect-[4/3] object-cover hover:scale-105 transition-transform cursor-pointer" src="https://images.unsplash.com/photo-1517682632624-58f03c8c3f89?q=80&w=800&auto=format&fit=crop" alt="Coffee beans" onerror="this.src='https://picsum.photos/seed/coffee/600/400'">
          <img class="rounded-xl aspect-[4/3] object-cover hover:scale-105 transition-transform cursor-pointer" src="https://images.unsplash.com/photo-1543294001-f7cd5d7fb515?q=80&w=800&auto=format&fit=crop" alt="Jewelry" onerror="this.src='https://picsum.photos/seed/jewelry/600/400'">
          <img class="rounded-xl aspect-[4/3] object-cover hover:scale-105 transition-transform cursor-pointer" src="https://images.unsplash.com/photo-1512499617640-c2f999098cbe?q=80&w=800&auto=format&fit=crop" alt="Tomatoes" onerror="this.src='https://picsum.photos/seed/tomatoes/600/400'">
          <img class="rounded-xl aspect-[4/3] object-cover hover:scale-105 transition-transform cursor-pointer" src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=800&auto=format&fit=crop" alt="Car" onerror="this.src='https://picsum.photos/seed/car/600/400'">
          <img class="rounded-xl aspect-[4/3] object-cover hover:scale-105 transition-transform cursor-pointer" src="https://images.unsplash.com/photo-1532635226-3f47b1b1b3b2?q=80&w=800&auto=format&fit=crop" alt="Oil" onerror="this.src='https://picsum.photos/seed/oil/600/400'">
          <img class="rounded-xl aspect-[4/3] object-cover hover:scale-105 transition-transform cursor-pointer" src="https://images.unsplash.com/photo-1513356233851-4f3f0a3a9a2b?q=80&w=800&auto=format&fit=crop" alt="Art" onerror="this.src='https://picsum.photos/seed/art/600/400'">
        </div>
        
        <div class="mt-4 grid grid-cols-3 gap-3 text-center text-xs">
          <div class="p-2 rounded-lg bg-white/5">
            <div class="font-medium" id="totalTransactions">...</div>
            <div class="text-white/60">Transactions</div>
          </div>
          <div class="p-2 rounded-lg bg-white/5">
            <div class="font-medium" id="satisfactionRate">...</div>
            <div class="text-white/60">Satisfaction</div>
          </div>
          <div class="p-2 rounded-lg bg-white/5">
            <div class="font-medium" id="totalSellers">...</div>
            <div class="text-white/60">Sellers</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Categories -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Popular Categories</h2>
      <a href="/categories.html" class="text-sm text-[color:var(--accent)] hover:underline">View all</a>
    </div>
    
    <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3">
      <a href="/category.html?cat=coffee" class="glass rounded-xl p-4 text-center hover:bg-white/5 transition-colors group">
        <div class="w-12 h-12 rounded-lg bg-[color:var(--accent-dark)] grid place-items-center mx-auto group-hover:scale-110 transition-transform">
          <i class="fa-solid fa-mug-hot"></i>
        </div>
        <div class="mt-2 text-sm font-medium">Coffee</div>
  <div class="text-xs text-white/60" id="cat-coffee">...</div>
      </a>
      
      <a href="/category.html?cat=jewelry" class="glass rounded-xl p-4 text-center hover:bg-white/5 transition-colors group">
        <div class="w-12 h-12 rounded-lg bg-[color:var(--accent-dark)] grid place-items-center mx-auto group-hover:scale-110 transition-transform">
          <i class="fa-solid fa-gem"></i>
        </div>
        <div class="mt-2 text-sm font-medium">Jewelry</div>
  <div class="text-xs text-white/60" id="cat-jewelry">...</div>
      </a>
      
      <a href="/category.html?cat=produce" class="glass rounded-xl p-4 text-center hover:bg-white/5 transition-colors group">
        <div class="w-12 h-12 rounded-lg bg-[color:var(--accent-dark)] grid place-items-center mx-auto group-hover:scale-110 transition-transform">
          <i class="fa-solid fa-apple-whole"></i>
        </div>
        <div class="mt-2 text-sm font-medium">Produce</div>
  <div class="text-xs text-white/60" id="cat-produce">...</div>
      </a>
      
      <a href="/category.html?cat=art" class="glass rounded-xl p-4 text-center hover:bg-white/5 transition-colors group">
        <div class="w-12 h-12 rounded-lg bg-[color:var(--accent-dark)] grid place-items-center mx-auto group-hover:scale-110 transition-transform">
          <i class="fa-solid fa-palette"></i>
        </div>
        <div class="mt-2 text-sm font-medium">Art</div>
  <div class="text-xs text-white/60" id="cat-art">...</div>
      </a>
      
      <a href="/category.html?cat=vehicles" class="glass rounded-xl p-4 text-center hover:bg-white/5 transition-colors group">
        <div class="w-12 h-12 rounded-lg bg-[color:var(--accent-dark)] grid place-items-center mx-auto group-hover:scale-110 transition-transform">
          <i class="fa-solid fa-car"></i>
        </div>
        <div class="mt-2 text-sm font-medium">Vehicles</div>
  <div class="text-xs text-white/60" id="cat-vehicles">...</div>
      </a>
      
      <a href="/category.html?cat=services" class="glass rounded-xl p-4 text-center hover:bg-white/5 transition-colors group">
        <div class="w-12 h-12 rounded-lg bg-[color:var(--accent-dark)] grid place-items-center mx-auto group-hover:scale-110 transition-transform">
          <i class="fa-solid fa-handshake"></i>
        </div>
        <div class="mt-2 text-sm font-medium">Services</div>
  <div class="text-xs text-white/60" id="cat-services">...</div>
      </a>
    </div>
  </section>

  <!-- Controls / Filters -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    <div class="glass rounded-2xl p-4 sm:p-5">
      <div class="flex flex-col sm:flex-row gap-4 sm:items-center justify-between">
        <div class="flex-1 flex items-center gap-3">
          <div class="relative flex-1">
            <input id="searchInput" type="search" placeholder="Search items, sellers, keywords…" class="w-full px-4 py-2.5 rounded-xl bg-black/30 border border-[color:var(--border)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)]" />
            <i class="fa-solid fa-magnifying-glass absolute right-3 top-1/2 -translate-y-1/2 text-white/50"></i>
          </div>
          <button id="clearFilters" class="px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors">Clear</button>
        </div>
        <div class="flex items-center gap-3">
          <select id="sortSelect" class="px-3 py-2 rounded-xl bg-black/30 border border-[color:var(--border)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)]">
            <option value="recent">Newest</option>
            <option value="price_asc">Price: Low → High</option>
            <option value="price_desc">Price: High → Low</option>
            <option value="alpha">A → Z</option>
            <option value="popular">Most Popular</option>
          </select>
          
          <button id="filterButton" class="px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors flex items-center gap-2">
            <i class="fa-solid fa-sliders"></i> Filters
          </button>
          
          <a href="/pvadashboard.html" class="hidden sm:inline-flex px-4 py-2 rounded-xl bg-[color:var(--accent)] text-black font-semibold hover:shadow-lg hover:shadow-[color:var(--accent-dark)]/25 transition-shadow">
            <i class="fa-solid fa-plus mr-2"></i>Sell an item
          </a>
        </div>
      </div>
      
      <!-- Advanced Filters (initially hidden) -->
      <div id="advancedFilters" class="hidden mt-4 pt-4 border-t border-[color:var(--border)]">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium mb-2">Price Range</label>
            <div class="flex items-center gap-2">
              <input type="number" placeholder="Min" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-[color:var(--border)]">
              <span class="text-white/60">to</span>
              <input type="number" placeholder="Max" class="w-full px-3 py-2 rounded-lg bg-black/30 border border-[color:var(--border)]">
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-2">Location</label>
            <select class="w-full px-3 py-2 rounded-lg bg-black/30 border border-[color:var(--border)]">
              <option value="">Any Location</option>
              <option value="north-america">North America</option>
              <option value="europe">Europe</option>
              <option value="asia">Asia</option>
              <option value="africa">Africa</option>
              <option value="south-america">South America</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-2">Provenance</label>
            <select class="w-full px-3 py-2 rounded-lg bg-black/30 border border-[color:var(--border)]">
              <option value="">Any</option>
              <option value="verified">Verified Only</option>
              <option value="non-verified">Non-Verified</option>
            </select>
          </div>
        </div>
        
        <div class="mt-4 flex justify-end gap-3">
          <button class="px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors">Reset</button>
          <button class="px-3 py-2 rounded-xl bg-[color:var(--accent)] text-black font-medium">Apply Filters</button>
        </div>
      </div>
      
      <div class="mt-4 flex flex-wrap gap-2" id="categoryChips"></div>
    </div>
  </section>

  <!-- Listings Grid -->
  <section id="listings" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">Featured Listings</h2>
      <div class="flex items-center gap-2">
        <button class="p-2 rounded-lg hover:bg-white/5 transition-colors" id="gridView">
          <i class="fa-solid fa-grid"></i>
        </button>
        <button class="p-2 rounded-lg hover:bg-white/5 transition-colors" id="listView">
          <i class="fa-solid fa-list"></i>
        </button>
      </div>
    </div>
    
    <div id="itemsGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>
    
    <div class="mt-8 flex items-center justify-between">
      <div class="text-sm text-white/70" id="resultsCount"></div>
      <div class="flex gap-2" id="pagination"></div>
    </div>
  </section>

  <!-- Newsletter Section -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12">
    <div class="glass rounded-2xl p-6 md:p-8 text-center">
      <h2 class="text-xl font-semibold">Stay Updated with PVA Bazaar</h2>
      <p class="mt-2 text-white/80 max-w-2xl mx-auto">Subscribe to our newsletter to receive updates on new features, marketplace insights, and exclusive offers.</p>
      
      <div class="mt-4 flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
        <input type="email" placeholder="Your email address" class="flex-1 px-4 py-2.5 rounded-xl bg-black/30 border border-[color:var(--border)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)]">
        <button class="px-4 py-2.5 rounded-xl bg-[color:var(--accent)] text-black font-semibold hover:shadow-lg hover:shadow-[color:var(--accent-dark)]/25 transition-shadow">Subscribe</button>
      </div>
      
      <div class="mt-3 text-xs text-white/60">We respect your privacy. Unsubscribe at any time.</div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-12">
    <h2 class="text-xl font-semibold text-center mb-6">What Our Users Say</h2>
    
    <div class="grid md:grid-cols-3 gap-5">
      <div class="glass rounded-2xl p-5">
        <div class="flex items-center gap-2 text-[color:var(--accent)]">
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
        </div>
        <p class="mt-3 text-white/80">"The provenance feature gives me confidence in my high-value purchases. I've bought several pieces of jewelry with verified history."</p>
        <div class="mt-4 flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-[color:var(--accent-dark)] grid place-items-center text-sm font-medium">SA</div>
          <div>
            <div class="font-medium">Sarah A.</div>
            <div class="text-xs text-white/60">Jewelry Collector</div>
          </div>
        </div>
      </div>
      
      <div class="glass rounded-2xl p-5">
        <div class="flex items-center gap-2 text-[color:var(--accent)]">
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
        </div>
        <p class="mt-3 text-white/80">"As a coffee producer, PVA Bazaar has opened up international markets for me. The NFT minting option adds value for my premium batches."</p>
        <div class="mt-4 flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-[color:var(--accent-dark)] grid place-items-center text-sm font-medium">MJ</div>
          <div>
            <div class="font-medium">Miguel J.</div>
            <div class="text-xs text-white/60">Coffee Producer</div>
          </div>
        </div>
      </div>
      
      <div class="glass rounded-2xl p-5">
        <div class="flex items-center gap-2 text-[color:var(--accent)]">
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star"></i>
          <i class="fa-solid fa-star-half-stroke"></i>
        </div>
        <p class="mt-3 text-white/80">"The interface is intuitive and the verification process for sellers is thorough. I feel secure trading high-value items here."</p>
        <div class="mt-4 flex items-center gap-3">
          <div class="w-10 h-10 rounded-full bg-[color:var(--accent-dark)] grid place-items-center text-sm font-medium">RK</div>
          <div>
            <div class="font-medium">Robert K.</div>
            <div class="text-xs text-white/60">Art Dealer</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="mt-12 border-t border-[color:var(--border)]">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl grid place-items-center bg-[color:var(--accent-dark)] text-white">
              <i class="fa-solid fa-leaf"></i>
            </div>
            <div>
              <div class="brand text-xl leading-none">PVA Bazaar</div>
              <div class="text-xs text-[color:var(--text-muted)] -mt-0.5">Independent Market • Provenance</div>
            </div>
          </div>
          <p class="mt-4 text-sm text-white/80">A global marketplace for independent trade with verified provenance and optional NFT minting.</p>
          
          <div class="mt-4 flex items-center gap-3">
            <a href="#" class="w-8 h-8 rounded-lg grid place-items-center bg-white/5 hover:bg-[color:var(--accent)] hover:text-black transition-colors">
              <i class="fa-brands fa-twitter"></i>
            </a>
            <a href="#" class="w-8 h-8 rounded-lg grid place-items-center bg-white/5 hover:bg-[color:var(--accent)] hover:text-black transition-colors">
              <i class="fa-brands fa-discord"></i>
            </a>
            <a href="#" class="w-8 h-8 rounded-lg grid place-items-center bg-white/5 hover:bg-[color:var(--accent)] hover:text-black transition-colors">
              <i class="fa-brands fa-instagram"></i>
            </a>
            <a href="#" class="w-8 h-8 rounded-lg grid place-items-center bg-white/5 hover:bg-[color:var(--accent)] hover:text-black transition-colors">
              <i class="fa-brands fa-linkedin"></i>
            </a>
          </div>
        </div>
        
        <div>
          <h3 class="font-semibold text-lg mb-4">Marketplace</h3>
          <ul class="space-y-2 text-sm text-white/80">
            <li><a href="/categories.html" class hover:text-white transition-colors>All Categories</a></li>
            <li><a href="/featured.html" class hover:text-white transition-colors>Featured Listings</a></li>
            <li><a href="/provenance.html" class hover:text-white transition-colors>Provenance Verification</a></li>
            <li><a href="/nft.html" class hover:text-white transition-colors>NFT Minting</a></li>
            <li><a href="/seller-guide.html" class hover:text-white transition-colors>Seller's Guide</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="font-semibold text-lg mb-4">Company</h3>
          <ul class="space-y-2 text-sm text-white/80">
            <li><a href="/about.html" class hover:text-white transition-colors>About Us</a></li>
            <li><a href="/contact.html" class hover:text-white transition-colors>Contact</a></li>
            <li><a href="/careers.html" class hover:text-white transition-colors>Careers</a></li>
            <li><a href="/blog.html" class hover:text-white transition-colors>Blog</a></li>
            <li><a href="/press.html" class hover:text-white transition-colors>Press</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="font-semibold text-lg mb-4">Support</h3>
          <ul class="space-y-2 text-sm text-white/80">
            <li><a href="/help.html" class hover:text-white transition-colors>Help Center</a></li>
            <li><a href="/faq.html" class hover:text-white transition-colors>FAQs</a></li>
            <li><a href="/terms.html" class hover:text-white transition-colors>Terms of Service</a></li>
            <li><a href="/privacy.html" class hover:text-white transition-colors>Privacy Policy</a></li>
            <li><a href="/disputes.html" class hover:text-white transition-colors>Dispute Resolution</a></li>
          </ul>
        </div>
      </div>
      
      <div class="mt-8 pt-8 border-t border-[color:var(--border)] flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="text-sm text-white/70">© <span id="year"></span> PVA Bazaar • Trade freely with transparency.</div>
        <div class="text-sm flex items-center gap-4">
          <a href="/provenance.html" class="hover:underline">Provenance</a>
          <a href="/artifact.html" class="hover:underline">Artifacts</a>
          <a href="/checkoutmint.html" class="hover:underline">Mint</a>
          <a href="/pvadashboard.html" class="hover:underline">Sell</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Mobile Floating Action Button -->
  <a href="/pvadashboard.html" class="fab md:hidden">
    <i class="fa-solid fa-plus"></i>
  </a>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <i class="fa-solid fa-circle-check text-[color:var(--accent)]"></i>
    <span id="toastMessage"></span>
  </div>

  <!-- Modal -->
  <div id="itemModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60" onclick="closeModal()"></div>
    <div class="relative max-w-3xl mx-auto mt-16 mb-8 bg-[#0b1b15] border border-[color:var(--border)] rounded-2xl overflow-hidden">
      <div class="grid md:grid-cols-2">
        <div class="p-0 md:p-0">
          <img id="modalImg" class="w-full h-full object-cover aspect-square" alt="Item image" />
        </div>
        <div class="p-5">
          <h3 id="modalTitle" class="brand text-2xl"></h3>
          <div class="mt-1 text-white/70" id="modalCategory"></div>
          <div class="mt-3 flex items-center gap-3 text-lg">
            <span id="modalPrice" class="font-semibold"></span>
            <span class="text-white/60" id="modalUnit"></span>
          </div>
          <p id="modalDesc" class="mt-3 text-white/80"></p>
          <div class="mt-4 text-sm text-white/70" id="modalMeta"></div>
          
          <div class="mt-5 grid grid-cols-2 gap-3">
            <a id="modalBuy" class="px-4 py-2 rounded-xl bg-[color:var(--accent)] text-black text-center font-semibold hover:shadow-lg hover:shadow-[color:var(--accent-dark)]/25 transition-shadow" href="#" target="_self">Buy / Contact</a>
            <a id="modalMint" class="px-4 py-2 rounded-xl border border-[color:var(--border)] text-center hover:bg-white/5 transition-colors" href="#" target="_self">Mint as NFT</a>
            <a id="modalProv" class="col-span-2 px-4 py-2 rounded-xl border border-[color:var(--border)] text-center hover:bg-white/5 transition-colors" href="#" target="_self">View Provenance</a>
          </div>
          
          <button class="absolute top-3 right-3 w-10 h-10 rounded-full bg-black/40 grid place-items-center border border-[color:var(--border)] hover:bg-black/60 transition-colors" onclick="closeModal()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Fetch and render live marketplace stats and category counts
    async function fetchMarketplaceStats() {
      try {
        const res = await fetch('/api/marketplace/stats');
        const stats = await res.json();
        if (stats && stats.ok) {
          document.getElementById('activeListings').textContent = stats.activeListings.toLocaleString();
          document.getElementById('totalTransactions').textContent = stats.totalTransactions.toLocaleString();
          document.getElementById('satisfactionRate').textContent = stats.satisfactionRate + '%';
          document.getElementById('totalSellers').textContent = stats.totalSellers.toLocaleString();
        }
      } catch (e) {
        // fallback or error
        document.getElementById('activeListings').textContent = 'N/A';
        document.getElementById('totalTransactions').textContent = 'N/A';
        document.getElementById('satisfactionRate').textContent = 'N/A';
        document.getElementById('totalSellers').textContent = 'N/A';
      }
    }

    async function fetchCategoryCounts() {
      try {
        const res = await fetch('/api/categories/counts');
        const counts = await res.json();
        if (counts && counts.ok && counts.data) {
          if (counts.data.coffee) document.getElementById('cat-coffee').textContent = counts.data.coffee + ' listings';
          if (counts.data.jewelry) document.getElementById('cat-jewelry').textContent = counts.data.jewelry + ' listings';
          if (counts.data.produce) document.getElementById('cat-produce').textContent = counts.data.produce + ' listings';
          if (counts.data.art) document.getElementById('cat-art').textContent = counts.data.art + ' listings';
          if (counts.data.vehicles) document.getElementById('cat-vehicles').textContent = counts.data.vehicles + ' listings';
          if (counts.data.services) document.getElementById('cat-services').textContent = counts.data.services + ' listings';
        }
      } catch (e) {
        // fallback or error
        ['cat-coffee','cat-jewelry','cat-produce','cat-art','cat-vehicles','cat-services'].forEach(id=>{
          document.getElementById(id).textContent = 'N/A';
        });
      }
    }
    // ---------- Demo Data (replace with API / backend feed) ----------
    const CATEGORIES = [
      "Coffee", "Jewelry", "Produce", "Vehicles", "Energy", "Art", "Services", "Real Estate", "Electronics", "Fashion", "Collectibles"
    ];

    const ITEMS = [
      { id:"emerald-pendant", title:"Maradjet Emerald Pendant", category:"Jewelry", price:12500, unit:"USD", qty:"1 piece", location:"Panjshir → Dubai", seller:"PVA Admin", image:"https://images.unsplash.com/photo-1617038260897-42e4d5b3f8c7?q=80&w=1200&auto=format&fit=crop", description:"Handcrafted pendant featuring natural Panjshir emerald set in 18k gold.", provenance:true, date: "2025-09-01", rating: 4.9, reviews: 42 },
      { id:"single-origin-coffee", title:"Single-Origin Coffee Beans (Yirgacheffe)", category:"Coffee", price:7.5, unit:"USD / lb", qty:"2,000 lbs", location:"Ethiopia", seller:"Saba Cooperative", image:"https://images.unsplash.com/photo-1504630083234-14187a9df0f5?q=80&w=1200&auto=format&fit=crop", description:"Washed Yirgacheffe beans — floral, citrus. FOB Djibouti available.", provenance:true, date: "2025-08-20", rating: 4.7, reviews: 128 },
      { id:"heirloom-tomatoes", title:"Heirloom Tomatoes", category:"Produce", price:2.2, unit:"USD / lb", qty:"5,000 lbs", location:"San Joaquin Valley, CA", seller:"Valley Co-op", image:"https://images.unsplash.com/photo-1542831371-29b0f74f9713?q=80&w=1200&auto=format&fit=crop", description:"Mixed heirloom varieties, organic certified.", provenance:false, date: "2025-08-29", rating: 4.5, reviews: 86 },
      { id:"diesel-batch", title:"Refined Diesel (10ppm)", category:"Energy", price:0.86, unit:"USD / liter", qty:"1,000,000 L", location:"Fujairah", seller:"Gulf Energy Desk", image:"https://images.unsplash.com/photo-1542601906990-b4d3fb778b09?q=80&w=1200&auto=format&fit=crop", description:"Ultra-low sulfur diesel (EN590). CIF/FOB options.", provenance:false, date: "2025-09-05", rating: 4.3, reviews: 15 },
      { id:"classic-roadster", title:"Classic Roadster", category:"Vehicles", price:48000, unit:"USD", qty:"1 vehicle", location:"Irvine, CA", seller:"Private Collector", image:"https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1200&auto=format&fit=crop", description:"Meticulously restored, matching numbers.", provenance:true, date: "2025-07-22", rating: 5.0, reviews: 7 },
      { id:"abstract-oil", title:"Abstract Oil on Canvas", category:"Art", price:6200, unit:"USD", qty:"1 artwork", location:"Lisbon", seller:"Atelier M.", image:"https://images.unsplash.com/photo-1513356233851-4f3f0a3a9a2b?q=80&w=1200&auto=format&fit=crop", description:"Large-format piece, gallery wrapped.", provenance:true, date: "2025-09-03", rating: 4.8, reviews: 23 },
      { id:"solar-panels", title:"Solar Panels (450W)", category:"Energy", price:0.19, unit:"USD / W", qty:"100,000 W", location:"Shenzhen", seller:"SunTech Ltd.", image:"https://images.unsplash.com/photo-1509395176047-4a66953fd231?q=80&w=1200&auto=format&fit=crop", description:"Tier-1 mono PERC modules, IEC certified.", provenance:false, date: "2025-08-16", rating: 4.6, reviews: 45 },
      { id:"consulting-hours", title:"Cross-Border Trade Consulting", category:"Services", price:150, unit:"USD / hr", qty:"40 hrs", location:"Remote / Global", seller:"PVA Desk", image:"https://images.unsplash.com/photo-1517263904808-5dc91e3e7044?q=80&w=1200&auto=format&fit=crop", description:"Sourcing, logistics, compliance, escrow advisory.", provenance:false, date: "2025-08-30", rating: 4.9, reviews: 31 },
      { id:"downtown-loft", title:"Downtown Loft (Lease)", category:"Real Estate", price:3200, unit:"USD / mo", qty:"1 unit", location:"Los Angeles, CA", seller:"Urban Homes", image:"https://images.unsplash.com/photo-1486308510493-aa64833637b8?q=80&w=1200&auto=format&fit=crop", description:"Open floor plan, warehouse windows, pets OK.", provenance:false, date: "2025-08-10", rating: 4.4, reviews: 12 },
      { id:"artisan-ring", title:"Artisan Gold Ring", category:"Fashion", price:950, unit:"USD", qty:"3 pieces", location:"Athens", seller:"Helios Forge", image:"https://images.unsplash.com/photo-1543294001-f7cd5d7fb515?q=80&w=1200&auto=format&fit=crop", description:"Hand-rolled 18k, hammered finish.", provenance:true, date: "2025-09-02", rating: 4.7, reviews: 19 },
      { id:"vintage-console", title:"Vintage Game Console Bundle", category:"Electronics", price:420, unit:"USD", qty:"5 sets", location:"Berlin", seller:"RetroHaus", image:"https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=1200&auto=format&fit=crop", description:"Refurbished consoles + controllers + games.", provenance:false, date: "2025-07-30", rating: 4.8, reviews: 67 },
      { id:"rare-stamps", title:"Rare Stamp Collection", category:"Collectibles", price:7300, unit:"USD", qty:"1 lot", location:"Tokyo", seller:"Philately Lab", image:"https://images.unsplash.com/photo-1520697222860-5cb7e3b3f9f5?q=80&w=1200&auto=format&fit=crop", description:"Pre-war issues, graded and cataloged.", provenance:true, date: "2025-08-27", rating: 5.0, reviews: 9 }
    ];

    // ---------- State ----------
    let activeCategories = new Set();
    let searchTerm = ""; 
    let sortBy = "recent"; 
    let page = 1; 
    const PAGE_SIZE = 12;
    let isGridView = true;

    // ---------- Init ----------
    const chipsEl = document.getElementById('categoryChips');
    const gridEl = document.getElementById('itemsGrid');
    const resultsEl = document.getElementById('resultsCount');
    const paginationEl = document.getElementById('pagination');

    // Initialize category chips
    CATEGORIES.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = 'chip px-3 py-1.5 rounded-full text-sm hover:bg-white/5';
      btn.textContent = cat; 
      btn.dataset.cat = cat;
      btn.onclick = () => { toggleCategory(cat, btn) };
      chipsEl.appendChild(btn);
    });

    // Event listeners
    document.getElementById('searchInput').addEventListener('input', e => { 
      searchTerm = e.target.value.trim().toLowerCase(); 
      page = 1; 
      render() 
    });
    
    document.getElementById('sortSelect').addEventListener('change', e => { 
      sortBy = e.target.value; 
      render() 
    });
    
    document.getElementById('clearFilters').addEventListener('click', () => { 
      activeCategories.clear(); 
      Array.from(chipsEl.children).forEach(c=>c.classList.remove('active')); 
      searchTerm=''; 
      document.getElementById('searchInput').value=''; 
      sortBy='recent'; 
      document.getElementById('sortSelect').value='recent'; 
      page=1; 
      render(); 
    });
    
    document.getElementById('filterButton').addEventListener('click', () => {
      const filters = document.getElementById('advancedFilters');
      filters.classList.toggle('hidden');
    });
    
    document.getElementById('gridView').addEventListener('click', () => {
      isGridView = true;
      gridEl.className = 'grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5';
      render();
    });
    
    document.getElementById('listView').addEventListener('click', () => {
      isGridView = false;
      gridEl.className = 'grid grid-cols-1 gap-5';
      render();
    });
    
    document.getElementById('mobileMenuButton').addEventListener('click', () => {
      document.getElementById('mobileMenu').classList.toggle('hidden');
    });
    
    document.getElementById('year').textContent = new Date().getFullYear();

    function toggleCategory(cat, btn){
      if(activeCategories.has(cat)){ 
        activeCategories.delete(cat); 
        btn.classList.remove('active'); 
      } else { 
        activeCategories.add(cat); 
        btn.classList.add('active'); 
      }
      page = 1; 
      render();
    }

    function applyFilters(data){
      return data.filter(item => {
        const matchesCat = activeCategories.size ? activeCategories.has(item.category) : true;
        const q = searchTerm;
        const matchesSearch = q ? (
          item.title.toLowerCase().includes(q) ||
          item.description.toLowerCase().includes(q) ||
          item.seller.toLowerCase().includes(q) ||
          item.category.toLowerCase().includes(q) ||
          item.location.toLowerCase().includes(q)
        ) : true;
        return matchesCat && matchesSearch;
      }).sort((a,b)=>{
        if(sortBy==='price_asc') return (a.price||0)-(b.price||0);
        if(sortBy==='price_desc') return (b.price||0)-(a.price||0);
        if(sortBy==='alpha') return a.title.localeCompare(b.title);
        if(sortBy==='popular') return (b.rating||0)-(a.rating||0);
        // recent by date desc
        return new Date(b.date||0) - new Date(a.date||0);
      });
    }

    function paginate(list){
      const start = (page-1)*PAGE_SIZE; 
      return list.slice(start, start+PAGE_SIZE);
    }

    function render(){
      const filtered = applyFilters(ITEMS);
      const pageItems = paginate(filtered);
      gridEl.innerHTML = '';
      
      if (pageItems.length === 0) {
        gridEl.innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="fa-solid fa-magnifying-glass text-3xl text-white/40"></i>
            <div class="mt-3 font-medium">No items found</div>
            <p class="mt-1 text-white/60 max-w-md mx-auto">Try adjusting your search or filter criteria to find what you're looking for.</p>
            <button class="mt-4 px-4 py-2 rounded-xl bg-[color:var(--accent)] text-black font-semibold" onclick="document.getElementById('clearFilters').click()">
              Clear all filters
            </button>
          </div>`;
      } else {
        pageItems.forEach(item => {
          if (isGridView) {
            renderCard(item);
          } else {
            renderListCard(item);
          }
        });
      }
      
      resultsEl.textContent = `${filtered.length} result${filtered.length===1?'':'s'} • page ${page} of ${Math.max(1, Math.ceil(filtered.length/PAGE_SIZE))}`;
      renderPagination(Math.ceil(filtered.length/PAGE_SIZE));
    }

    function renderCard(item){
      const card = document.createElement('article');
      card.className = 'glass rounded-2xl overflow-hidden hover:shadow-lg hover:shadow-black/20 transition-all duration-300 animate-fade-in';
      card.innerHTML = `
        <div class="relative">
          <img src="${item.image}" alt="${item.title}" class="w-full aspect-[4/3] object-cover" onerror="this.src='https://picsum.photos/seed/${item.id}/800/600'" />
          ${item.provenance ? '<span class="absolute top-3 left-3 text-[10px] px-2 py-1 rounded-full bg-[color:var(--accent-dark)] text-black font-semibold"><i class="fa-solid fa-shield-check mr-1"></i>Provenance</span>' : ''}
          <button class="absolute top-3 right-3 w-8 h-8 rounded-full bg-black/40 grid place-items-center hover:bg-[color:var(--accent)] hover:text-black transition-colors">
            <i class="fa-regular fa-heart"></i>
          </button>
        </div>
        <div class="p-4">
          <div class="text-xs text-white/60">${item.category}</div>
          <h3 class="mt-0.5 font-semibold line-clamp-1">${item.title}</h3>
          
          <div class="mt-2 flex items-center gap-1">
            ${renderRatingStars(item.rating)}
            <span class="text-xs text-white/60">(${item.reviews})</span>
          </div>
          
          <div class="mt-2 text-sm text-white/80 line-clamp-2">${item.description}</div>
          <div class="mt-3 flex items-center justify-between">
            <div class="font-semibold">$${formatPrice(item.price)} <span class="text-xs text-white/60">${item.unit||''}</span></div>
            <div class="text-xs text-white/60"><i class="fa-solid fa-location-dot mr-1"></i>${item.location}</div>
          </div>
          <div class="mt-4 grid grid-cols-2 gap-2">
            <a href="/artifact.html?id=${item.id}" class="px-3 py-2 rounded-xl bg-[color:var(--accent)] text-black text-center font-semibold hover:shadow-lg hover:shadow-[color:var(--accent-dark)]/25 transition-shadow">Details</a>
            <button class="px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors" onclick='openModal(${JSON.stringify(item)})'>Quick view</button>
            <a href="/checkoutmint.html?id=${item.id}" class="col-span-2 px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors text-center"><i class="fa-solid fa-cubes-stacked mr-1"></i>Mint NFT</a>
          </div>
        </div>`;
      gridEl.appendChild(card);
    }

    function renderListCard(item) {
      const card = document.createElement('article');
      card.className = 'glass rounded-2xl overflow-hidden hover:shadow-lg hover:shadow-black/20 transition-all duration-300 animate-fade-in';
      card.innerHTML = `
        <div class="grid md:grid-cols-3 gap-4 p-4">
          <div class="relative">
            <img src="${item.image}" alt="${item.title}" class="w-full aspect-[4/3] object-cover rounded-xl" onerror="this.src='https://picsum.photos/seed/${item.id}/800/600'" />
            ${item.provenance ? '<span class="absolute top-3 left-3 text-[10px] px-2 py-1 rounded-full bg-[color:var(--accent-dark)] text-black font-semibold"><i class="fa-solid fa-shield-check mr-1"></i>Provenance</span>' : ''}
          </div>
          <div class="md:col-span-2">
            <div class="text-xs text-white/60">${item.category}</div>
            <h3 class="mt-0.5 font-semibold">${item.title}</h3>
            
            <div class="mt-2 flex items-center gap-1">
              ${renderRatingStars(item.rating)}
              <span class="text-xs text-white/60">(${item.reviews})</span>
            </div>
            
            <div class="mt-2 text-sm text-white/80">${item.description}</div>
            
            <div class="mt-4 flex items-center justify-between flex-wrap gap-3">
              <div class="font-semibold">$${formatPrice(item.price)} <span class="text-xs text-white/60">${item.unit||''}</span></div>
              <div class="text-xs text-white/60"><i class="fa-solid fa-location-dot mr-1"></i>${item.location}</div>
            </div>
            
            <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-2">
              <a href="/artifact.html?id=${item.id}" class="px-3 py-2 rounded-xl bg-[color:var(--accent)] text-black text-center font-semibold hover:shadow-lg hover:shadow-[color:var(--accent-dark)]/25 transition-shadow text-sm">Details</a>
              <button class="px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors text-sm" onclick='openModal(${JSON.stringify(item)})'>Quick view</button>
              <a href="/checkoutmint.html?id=${item.id}" class="px-3 py-2 rounded-xl border border-[color:var(--border)] hover:bg-white/5 transition-colors text-center text-sm col-span-2"><i class="fa-solid fa-cubes-stacked mr-1"></i>Mint NFT</a>
            </div>
          </div>
        </div>`;
      gridEl.appendChild(card);
    }

    function renderRatingStars(rating) {
      let stars = '';
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 >= 0.5;
      
      for (let i = 0; i < fullStars; i++) {
        stars += '<i class="fa-solid fa-star text-[color:var(--accent)] text-xs"></i>';
      }
      
      if (hasHalfStar) {
        stars += '<i class="fa-solid fa-star-half-stroke text-[color:var(--accent)] text-xs"></i>';
      }
      
      const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
      for (let i = 0; i < emptyStars; i++) {
        stars += '<i class="fa-regular fa-star text-[color:var(--accent)] text-xs"></i>';
      }
      
      return stars;
    }

    function renderPagination(totalPages){
      paginationEl.innerHTML = '';
      
      const prev = document.createElement('button'); 
      prev.innerHTML = '<i class="fa-solid fa-chevron-left"></i>'; 
      prev.className='w-10 h-10 rounded-xl border border-[color:var(--border)] disabled:opacity-40 hover:bg-white/5 transition-colors'; 
      prev.disabled = page<=1; 
      prev.onclick = ()=>{page--; render()};
      
      const next = document.createElement('button'); 
      next.innerHTML = '<i class="fa-solid fa-chevron-right"></i>'; 
      next.className='w-10 h-10 rounded-xl border border-[color:var(--border)] disabled:opacity-40 hover:bg-white/5 transition-colors'; 
      next.disabled = page>=totalPages; 
      next.onclick = ()=>{page++; render()};
      
      const label = document.createElement('span'); 
      label.className='px-2 py-2 text-sm text-white/70'; 
      label.textContent = `Page ${page}/${Math.max(totalPages,1)}`;
      
      paginationEl.append(prev, label, next);
    }

    function formatPrice(n){
      if(n>=1000) return n.toLocaleString(undefined,{maximumFractionDigits:2});
      return (Math.round(n*100)/100).toString();
    }

    // ---------- Modal ----------
    function openModal(item){
      document.getElementById('modalImg').src = item.image;
      document.getElementById('modalTitle').textContent = item.title;
      document.getElementById('modalCategory').textContent = item.category + (item.provenance?' • Provenance enabled':'');
      document.getElementById('modalPrice').textContent = `$${formatPrice(item.price)}`;
      document.getElementById('modalUnit').textContent = item.unit||'';
      document.getElementById('modalDesc').textContent = item.description;
      document.getElementById('modalMeta').textContent = `${item.qty||''} • Seller: ${item.seller||'—'} • ${item.location||''}`;
      document.getElementById('modalBuy').href = `/artifact.html?id=${item.id}`;
      document.getElementById('modalMint').href = `/checkoutmint.html?id=${item.id}`;
      document.getElementById('modalProv').href = `/provenance.html?id=${item.id}`;
      document.getElementById('itemModal').classList.remove('hidden');
    }
    
    function closeModal(){ 
      document.getElementById('itemModal').classList.add('hidden'); 
    }

    // Show toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      
      toastMessage.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Initialize service worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    // Render on load
    render();
    fetchMarketplaceStats();
    fetchCategoryCounts();
    // Simulate loading
    setTimeout(() => {
      showToast('Marketplace loaded successfully');
    }, 1000);
  </script>
  
  
  <script src="/src/nav/inject-nav.js" defer></script>
  <script src="/public/js/pva-nav.js" defer></script>
</body>
</html>